<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/com/example/proyectoprogra/controllers/Visualizacion/RegisterController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/example/proyectoprogra/controllers/Visualizacion/RegisterController.java" />
              <option name="originalContent" value="package com.example.proyectoprogra.controllers.Visualizacion;&#10;&#10;import com.example.proyectoprogra.ConexionDB.ConexionDB;&#10;import com.example.proyectoprogra.models.PasswordUtils;&#10;import javafx.fxml.FXML;&#10;import javafx.fxml.FXMLLoader;&#10;import javafx.scene.Node;&#10;import javafx.scene.Parent;&#10;import javafx.scene.Scene;&#10;import javafx.scene.control.*;&#10;import javafx.stage.Stage;&#10;&#10;import java.io.IOException;&#10;import java.net.URL;&#10;import java.sql.Connection;&#10;import java.sql.PreparedStatement;&#10;import java.sql.SQLException;&#10;import java.util.function.Consumer;&#10;&#10;public class RegisterController {&#10;&#10;    @FXML private TextField campoNombreReg;&#10;    @FXML private TextField campoApellidoReg;&#10;    @FXML private TextField campoEmailReg;&#10;    @FXML private PasswordField campoContrasenaReg;&#10;    @FXML private PasswordField campoContrasenaRegConfirm;&#10;    @FXML private Button btnCrearCuentaReg;&#10;    @FXML private Button btnCancelarReg;&#10;    @FXML private Label mensajeReg;&#10;&#10;    private Consumer&lt;String&gt; onSuccessCallback;&#10;&#10;    public void setOnSuccess(Consumer&lt;String&gt; callback) {&#10;        this.onSuccessCallback = callback;&#10;    }&#10;&#10;    @FXML&#10;    public void initialize() {&#10;        // Aplicar CSS al Scene cuando esté disponible&#10;        String cssPath = &quot;/com/example/proyectoprogra/css/register.css&quot;;&#10;        if (btnCrearCuentaReg != null) {&#10;            btnCrearCuentaReg.sceneProperty().addListener((obs, oldScene, newScene) -&gt; {&#10;                if (newScene != null) {&#10;                    URL cssUrl = getClass().getResource(cssPath);&#10;                    if (cssUrl != null) newScene.getStylesheets().add(cssUrl.toExternalForm());&#10;                }&#10;            });&#10;        }&#10;    }&#10;&#10;    @FXML&#10;    private void registrarUsuario() {&#10;        String nombre = campoNombreReg.getText().trim();&#10;        String apellido = campoApellidoReg.getText().trim();&#10;        String email = campoEmailReg.getText().trim();&#10;        String pass = campoContrasenaReg.getText().trim();&#10;        String pass2 = campoContrasenaRegConfirm.getText().trim();&#10;&#10;        if (nombre.isBlank() || email.isBlank() || pass.isBlank() || pass2.isBlank()) {&#10;            mensajeReg.setText(&quot;Por favor complete todos los campos.&quot;);&#10;            return;&#10;        }&#10;&#10;        if (!pass.equals(pass2)) {&#10;            mensajeReg.setText(&quot;Las contraseñas no coinciden.&quot;);&#10;            return;&#10;        }&#10;&#10;        try (Connection conection = ConexionDB.getConection()) {&#10;            String sql = &quot;INSERT INTO tbl_usuarios (nombre, apellido, correo, contraseña, id_rol) VALUES (?, ?, ?, ?, ?)&quot;;&#10;            PreparedStatement ps = conection.prepareStatement(sql);&#10;            ps.setString(1, nombre);&#10;            ps.setString(2, apellido);&#10;            ps.setString(3, email);&#10;            ps.setString(4, PasswordUtils.hashPassword(pass));&#10;            ps.setInt(5, 2);&#10;&#10;            int filas = ps.executeUpdate();&#10;            if (filas &gt; 0) {&#10;                mensajeReg.setText(&quot;Cuenta creada correctamente. Puedes iniciar sesión.&quot;);&#10;                campoNombreReg.clear();&#10;                campoApellidoReg.clear();&#10;                campoEmailReg.clear();&#10;                campoContrasenaReg.clear();&#10;                campoContrasenaRegConfirm.clear();&#10;&#10;                if (onSuccessCallback != null) {&#10;                    onSuccessCallback.accept(email);&#10;                }&#10;            } else {&#10;                mensajeReg.setText(&quot;Error al crear la cuenta.&quot;);&#10;            }&#10;&#10;        } catch (SQLException e) {&#10;            mensajeReg.setText(&quot;Error de conexión: &quot; + e.getMessage());&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;&#10;    @FXML&#10;    private void cerrar() {&#10;        cambiarVista(&quot;/com/example/proyectoprogra/Visualizacion/login-view.fxml&quot;,&#10;                &quot;Iniciar Sesión&quot;,&#10;                null,&#10;                btnCancelarReg); // usamos el botón para obtener el Stage&#10;    }&#10;&#10;    /**&#10;     * Método centralizado para cambiar vistas dentro del mismo Stage&#10;     * sin ScrollPane ni forzar maximizado&#10;     */&#10;    private void cambiarVista(String fxmlPath, String titulo, String cssPath, Node sourceNode) {&#10;        try {&#10;            FXMLLoader loader = new FXMLLoader(getClass().getResource(fxmlPath));&#10;            Parent root = loader.load();&#10;&#10;            if (cssPath != null) {&#10;                root.getStylesheets().add(getClass().getResource(cssPath).toExternalForm());&#10;            }&#10;&#10;            Stage stage = (Stage) sourceNode.getScene().getWindow();&#10;            Scene scene = stage.getScene();&#10;            scene.setRoot(root);&#10;&#10;            // Aplicar las hojas de estilo de la nueva vista al Scene&#10;            scene.getStylesheets().clear();&#10;            if (root.getStylesheets() != null &amp;&amp; !root.getStylesheets().isEmpty()) {&#10;                scene.getStylesheets().addAll(root.getStylesheets());&#10;            }&#10;&#10;            stage.setTitle(titulo);&#10;            stage.show();&#10;&#10;        } catch (IOException e) {&#10;            e.printStackTrace();&#10;            mensajeReg.setText(&quot;Error al cargar la vista: &quot; + fxmlPath);&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.proyectoprogra.controllers.Visualizacion;&#10;&#10;import com.example.proyectoprogra.ConexionDB.ConexionDB;&#10;import com.example.proyectoprogra.models.PasswordUtils;&#10;import javafx.fxml.FXML;&#10;import javafx.fxml.FXMLLoader;&#10;import javafx.scene.Node;&#10;import javafx.scene.Parent;&#10;import javafx.scene.Scene;&#10;import javafx.scene.control.*;&#10;import javafx.stage.Stage;&#10;&#10;import java.io.IOException;&#10;import java.net.URL;&#10;import java.sql.Connection;&#10;import java.sql.PreparedStatement;&#10;import java.sql.SQLException;&#10;import java.util.function.Consumer;&#10;import java.util.logging.Level;&#10;import java.util.logging.Logger;&#10;&#10;public class RegisterController {&#10;&#10;    private static final Logger LOGGER = Logger.getLogger(RegisterController.class.getName());&#10;&#10;    @FXML private TextField campoNombreReg;&#10;    @FXML private TextField campoApellidoReg;&#10;    @FXML private TextField campoEmailReg;&#10;    @FXML private PasswordField campoContrasenaReg;&#10;    @FXML private PasswordField campoContrasenaRegConfirm;&#10;    @FXML private Button btnCrearCuentaReg;&#10;    @FXML private Button btnCancelarReg;&#10;    @FXML private Label mensajeReg;&#10;&#10;    private Consumer&lt;String&gt; onSuccessCallback;&#10;&#10;    public void setOnSuccess(Consumer&lt;String&gt; callback) {&#10;        this.onSuccessCallback = callback;&#10;    }&#10;&#10;    @FXML&#10;    public void initialize() {&#10;        // Aplicar CSS al Scene cuando esté disponible&#10;        String cssPath = &quot;/com/example/proyectoprogra/css/register.css&quot;;&#10;        if (btnCrearCuentaReg != null) {&#10;            btnCrearCuentaReg.sceneProperty().addListener((obs, oldScene, newScene) -&gt; {&#10;                if (newScene != null) {&#10;                    URL cssUrl = getClass().getResource(cssPath);&#10;                    if (cssUrl != null) newScene.getStylesheets().add(cssUrl.toExternalForm());&#10;                }&#10;            });&#10;        }&#10;    }&#10;&#10;    @FXML&#10;    private void registrarUsuario() {&#10;        String nombre = campoNombreReg.getText().trim();&#10;        String apellido = campoApellidoReg.getText().trim();&#10;        String email = campoEmailReg.getText().trim();&#10;        String pass = campoContrasenaReg.getText().trim();&#10;        String pass2 = campoContrasenaRegConfirm.getText().trim();&#10;&#10;        if (nombre.isBlank() || email.isBlank() || pass.isBlank() || pass2.isBlank()) {&#10;            mensajeReg.setText(&quot;Por favor complete todos los campos.&quot;);&#10;            return;&#10;        }&#10;&#10;        if (!pass.equals(pass2)) {&#10;            mensajeReg.setText(&quot;Las contraseñas no coinciden.&quot;);&#10;            return;&#10;        }&#10;&#10;        try (Connection conection = ConexionDB.getConection()) {&#10;            String sql = &quot;INSERT INTO tbl_usuarios (nombre, apellido, correo, contraseña, id_rol) VALUES (?, ?, ?, ?, ?)&quot;;&#10;            PreparedStatement ps = conection.prepareStatement(sql);&#10;            ps.setString(1, nombre);&#10;            ps.setString(2, apellido);&#10;            ps.setString(3, email);&#10;            ps.setString(4, PasswordUtils.hashPassword(pass));&#10;            ps.setInt(5, 2);&#10;&#10;            int filas = ps.executeUpdate();&#10;            if (filas &gt; 0) {&#10;                mensajeReg.setText(&quot;Cuenta creada correctamente. Puedes iniciar sesión.&quot;);&#10;                campoNombreReg.clear();&#10;                campoApellidoReg.clear();&#10;                campoEmailReg.clear();&#10;                campoContrasenaReg.clear();&#10;                campoContrasenaRegConfirm.clear();&#10;&#10;                if (onSuccessCallback != null) {&#10;                    onSuccessCallback.accept(email);&#10;                }&#10;            } else {&#10;                mensajeReg.setText(&quot;Error al crear la cuenta.&quot;);&#10;            }&#10;&#10;        } catch (SQLException e) {&#10;            LOGGER.log(Level.SEVERE, &quot;Error al crear usuario&quot;, e);&#10;            mensajeReg.setText(&quot;Error de conexión: &quot; + e.getMessage());&#10;        }&#10;    }&#10;&#10;    @FXML&#10;    private void cerrar() {&#10;        cambiarVista(&quot;/com/example/proyectoprogra/Visualizacion/login-view.fxml&quot;,&#10;                &quot;Iniciar Sesión&quot;,&#10;                null,&#10;                btnCancelarReg); // usamos el botón para obtener el Stage&#10;    }&#10;&#10;    /**&#10;     * Método centralizado para cambiar vistas dentro del mismo Stage&#10;     * sin ScrollPane ni forzar maximizado&#10;     */&#10;    private void cambiarVista(String fxmlPath, String titulo, String cssPath, Node sourceNode) {&#10;        try {&#10;            FXMLLoader loader = new FXMLLoader(getClass().getResource(fxmlPath));&#10;            Parent root = loader.load();&#10;&#10;            if (cssPath != null) {&#10;                URL cssUrl = getClass().getResource(cssPath);&#10;                if (cssUrl != null) root.getStylesheets().add(cssUrl.toExternalForm());&#10;            }&#10;&#10;            Stage stage = (Stage) sourceNode.getScene().getWindow();&#10;            // reemplazamos root y aplicamos stylesheets de la nueva vista&#10;            stage.getScene().setRoot(root);&#10;            stage.getScene().getStylesheets().clear();&#10;            if (root.getStylesheets() != null &amp;&amp; !root.getStylesheets().isEmpty()) {&#10;                stage.getScene().getStylesheets().addAll(root.getStylesheets());&#10;            }&#10;&#10;            stage.setTitle(titulo);&#10;            stage.show();&#10;&#10;        } catch (IOException e) {&#10;            LOGGER.log(Level.SEVERE, &quot;Error al cargar la vista: &quot; + fxmlPath, e);&#10;            mensajeReg.setText(&quot;Error al cargar la vista: &quot; + fxmlPath);&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>